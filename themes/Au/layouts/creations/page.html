{{ define "main" }}
{{- $page := . -}}  <div class="creation-container">
    
    <section class="creation-list">
        <h2 class="sidebar-heading">Creations</h2>
        
        <div class="sidebar-separator"></div> 

        <ul>
          {{/* Loop up all pages of the 'creations' type for the sidebar list */}}
          {{ range (where .Site.RegularPages "Type" "in" "creations").ByDate.Reverse }}
            <li class="{{ if eq .Permalink $.Permalink }}active-sidebar-link{{ end }}">
              <a href="{{ .RelPermalink }}">{{ .Title }}</a>
            </li>
          {{ end }}
        </ul>
    </section>

    <section class="creation">
        
        <h2 class="creation-title">{{ $page.Title }}</h2>
        
        <div class="creation-narrative">
            {{ $page.Content }}
        </div>

        {{/* In layouts/creations/single.html */}}

{{ with .Params.image_main }}
    {{/* CRITICAL FIX: Anchor the image search to the current page ($) and use the image parameter */}}
    {{- $imgResource := $.Page.Resources.GetMatch . -}} 

    {{- if $imgResource }}
        {{/* 1. Anchor the current page to a consistent variable for clarity */}}
        {{- $page := $.Page -}}

        {{/* 2. Process the image to create responsive sizes */}}
        {{- $small := $imgResource.Resize "600x" -}}
        {{- $medium := $imgResource.Resize "1200x" -}}
        {{- $srcset := printf "%s %dw, %s %dw" $small.RelPermalink $small.Width $medium.RelPermalink $medium.Width -}}

        <figure class="featured-image">
            <img 
                src="{{ $small.RelPermalink }}" 
                srcset="{{ $srcset }}" 
                sizes="(max-width: 800px) 100vw, 900px"
                {{/* Ensure alt text is pulled from the main page context ($page) */}}
                alt="{{ $page.Params.alt_text | default $page.Title }}" 
            />
        </figure>
    {{ end }}
{{ end }}
        
        <h3 class="technical-heading">Materials & Techniques</h3>

        <div class="specs-grid">
            
            <div class="materials-list">
                <h4>Materials Used</h4>
                <ul class="clean-list">
                    {{ range $page.Params.materials }}
                        <li>{{ . }}</li>
                    {{ end }}
                </ul>
            </div>
            
            {{ with $page.Params.technique }}
            <div class="tech-list">
                <h4>Techniques Employed</h4>
                <ul class="clean-list">
                    {{ range . }}
                        <li>{{ . }}</li>
                    {{ end }}
                </ul>
            </div>
            {{ end }}
        </div>
        
        {{ with $page.GetTerms "materials" }}
        <div class="related-links-block">
            <h4>Discover More by Material</h4>
            <div class="tag-links">
                {{ range . }}
                    <a href="{{ .RelPermalink }}" class="tag">{{ .LinkTitle }}</a>
                {{ end }}
            </div>
        </div>
        {{ end }}

    </section>
</div>

{{ end }}